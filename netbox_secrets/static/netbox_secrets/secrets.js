"use strict";(()=>{var M=Object.create;var b=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var C=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty;var B=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var D=(e,n,i,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of R(n))!_.call(e,o)&&o!==i&&b(e,o,{get:()=>n[o],enumerable:!(t=P(n,o))||t.enumerable});return e};var H=(e,n,i)=>(i=e!=null?M(C(e)):{},D(n||!e||!e.__esModule?b(i,"default",{value:e,enumerable:!0}):i,e));var p=(e,n,i)=>new Promise((t,o)=>{var a=c=>{try{s(i.next(c))}catch(l){o(l)}},r=c=>{try{s(i.throw(c))}catch(l){o(l)}},s=c=>c.done?t(c.value):Promise.resolve(c.value).then(a,r);s((i=i.apply(e,n)).next())});var h=B(E=>{"use strict";E.parse=O;E.serialize=q;var I=Object.prototype.toString,m=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function O(e,n){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var i={},t=n||{},o=t.decode||$,a=0;a<e.length;){var r=e.indexOf("=",a);if(r===-1)break;var s=e.indexOf(";",a);if(s===-1)s=e.length;else if(s<r){a=e.lastIndexOf(";",r-1)+1;continue}var c=e.slice(a,r).trim();if(i[c]===void 0){var l=e.slice(r+1,s).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1)),i[c]=F(l,o)}a=s+1}return i}function q(e,n,i){var t=i||{},o=t.encode||K;if(typeof o!="function")throw new TypeError("option encode is invalid");if(!m.test(e))throw new TypeError("argument name is invalid");var a=o(n);if(a&&!m.test(a))throw new TypeError("argument val is invalid");var r=e+"="+a;if(t.maxAge!=null){var s=t.maxAge-0;if(isNaN(s)||!isFinite(s))throw new TypeError("option maxAge is invalid");r+="; Max-Age="+Math.floor(s)}if(t.domain){if(!m.test(t.domain))throw new TypeError("option domain is invalid");r+="; Domain="+t.domain}if(t.path){if(!m.test(t.path))throw new TypeError("option path is invalid");r+="; Path="+t.path}if(t.expires){var c=t.expires;if(!j(c)||isNaN(c.valueOf()))throw new TypeError("option expires is invalid");r+="; Expires="+c.toUTCString()}if(t.httpOnly&&(r+="; HttpOnly"),t.secure&&(r+="; Secure"),t.priority){var l=typeof t.priority=="string"?t.priority.toLowerCase():t.priority;switch(l){case"low":r+="; Priority=Low";break;case"medium":r+="; Priority=Medium";break;case"high":r+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(t.sameSite){var u=typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite;switch(u){case!0:r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return r}function $(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function K(e){return encodeURIComponent(e)}function j(e){return I.call(e)==="[object Date]"||e instanceof Date}function F(e,n){try{return n(e)}catch(i){return e}}});function d(e,n,i,t){let o="mdi-alert";switch(e){case"warning":o="mdi-alert";break;case"success":o="mdi-check-circle";break;case"info":o="mdi-information";break;case"danger":o="mdi-alert";break}let a=document.createElement("div");a.setAttribute("class","toast-container position-fixed bottom-0 end-0 m-3");let r=document.createElement("div");r.setAttribute("class",`toast bg-${e}`),r.setAttribute("role","alert"),r.setAttribute("aria-live","assertive"),r.setAttribute("aria-atomic","true");let s=document.createElement("div");s.setAttribute("class",`toast-header bg-${e} text-body`);let c=document.createElement("i");c.setAttribute("class",`mdi ${o}`);let l=document.createElement("strong");l.setAttribute("class","me-auto ms-1"),l.innerText=n;let u=document.createElement("button");u.setAttribute("type","button"),u.setAttribute("class","btn-close"),u.setAttribute("data-bs-dismiss","toast"),u.setAttribute("aria-label","Close");let y=document.createElement("div");if(y.setAttribute("class","toast-body"),s.appendChild(c),s.appendChild(l),typeof t!="undefined"){let g=document.createElement("small");g.setAttribute("class","text-muted"),s.appendChild(g)}return s.appendChild(u),y.innerText=i.trim(),r.appendChild(s),r.appendChild(y),a.appendChild(r),document.body.appendChild(a),new window.Toast(r)}var T=H(h());function A(e){return"error"in e&&"exception"in e}function f(e){return"error"in e}function v(e){return"value"in e&&"required"in e}function N(){let{csrftoken:e}=T.default.parse(document.cookie);if(typeof e=="undefined")throw new Error("Invalid or missing CSRF token");return e}function S(e,n,i){return p(this,null,function*(){let t=N(),o=new Headers({"X-CSRFToken":t}),a;typeof i!="undefined"&&(a=JSON.stringify(i),o.set("content-type","application/json"),o.set("Accept","application/json"));let r=yield fetch(e,{method:n,body:a,headers:o,credentials:"same-origin"}),s=r.headers.get("Content-Type");if(typeof s=="string"&&s.includes("text"))return{error:yield r.text()};let c=yield r.json();return!r.ok&&Array.isArray(c)?{error:c.join(`
`)}:!r.ok&&"detail"in c?{error:c.detail}:c})}function L(e,n){return p(this,null,function*(){return yield S(e,"POST",n)})}function k(e){return p(this,null,function*(){return yield S(e,"GET")})}function G(){let e=document.getElementById("new_keypair_modal"),n=document.getElementById("use_new_pubkey"),i=document.getElementById("copy_prikey");if(e===null||n===null||i===null)return;let t=e.querySelector("textarea#new_pubkey"),o=e.querySelector("textarea#new_privkey");function a(){for(let s of[t,o])s!==null&&s.setAttribute("readonly","");k("/api/plugins/secrets/generate-rsa-key-pair/").then(s=>{if(f(s))d("danger","Error",s.error).show();else{let{private_key:c,public_key:l}=s;t!==null&&o!==null&&(t.value=l,o.value=c)}})}function r(){let s=document.getElementById("id_public_key");t!==null&&(s.value=t.value,s.innerText=t.value)}e.addEventListener("shown.bs.modal",()=>a()),n.addEventListener("click",()=>r()),i.addEventListener("click",()=>navigator.clipboard.writeText((o==null?void 0:o.value)||""))}function x(e,n){let i=document.querySelector(`button.unlock-secret[secret-id='${e}']`),t=document.querySelector(`button.lock-secret[secret-id='${e}']`),o=document.querySelector(`span[secret-id='${e}']`);i!==null&&(n==="unlock"&&i.classList.add("d-none"),n==="lock"&&i.classList.remove("d-none")),t!==null&&(n==="unlock"&&t.classList.remove("d-none"),n==="lock"&&t.classList.add("d-none")),o!==null&&(n==="unlock"&&o.classList.remove("d-none"),n==="lock"&&o.classList.add("d-none"))}function U(){let e=new window.Modal("#privkey_modal");function n(t){let o=document.getElementById(`secret_${t}`);typeof t=="string"&&t!==""&&k(`/api/plugins/secrets/secrets/${t}/`).then(a=>{if(f(a))a.error.toLowerCase().includes("invalid session key")?e.show():d("danger","Error",a.error).show();else{let{plaintext:r}=a;o!==null&&r!==null?(v(o)?o.value=r:o.innerText=r,x(t,"unlock")):e.show()}})}function i(t){if(typeof t=="string"&&t!==""){let o=document.getElementById(`secret_${t}`);v(o)?o.value="********":o.innerText="********",x(t,"lock")}}for(let t of document.querySelectorAll("button.unlock-secret"))t.addEventListener("click",()=>n(t.getAttribute("secret-id")));for(let t of document.querySelectorAll("button.lock-secret"))t.addEventListener("click",()=>i(t.getAttribute("secret-id")))}function z(e){L("/api/plugins/secrets/session-keys/",{private_key:e,preserve_key:!0}).then(n=>{if(!f(n))window.location.pathname==="/plugins/secrets/user-key/"?window.location.reload():d("success","Session Key Received","You may now unlock secrets.").show();else{let i=n.error;A(n)&&(i+=`
${n.exception}`),d("danger","Failed to Retrieve Session Key",i).show()}})}function J(){for(let n of document.querySelectorAll("#request_session_key")){let i=function(){for(let t of document.querySelectorAll("#user_privkey"))z(t.value),t.value=""};var e=i;n.addEventListener("click",i)}}function X(){let e=new window.Modal("#privkey_modal");function n(i){document.cookie.indexOf("netbox_secrets_sessionid")===-1&&(i.preventDefault(),e.show())}for(let i of document.querySelectorAll(".requires-session-key")){let t=i.closest("form");t!==null&&t.addEventListener("submit",n)}}function w(){for(let e of[G,U,J,X])e()}document.readyState!=="loading"?w():document.addEventListener("DOMContentLoaded",w);})();
/*! Bundled license information:

cookie/index.js:
  (*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)
*/
//# sourceMappingURL=/static/netbox_secrets/secrets.js.map
